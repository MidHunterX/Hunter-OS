# vim: set filetype=toml :

# NOTE: The panic sequence: <backspace>+<escape>+<enter> will terminate keyd.
# This file needs to be in: /etc/keyd/default.conf
# sudo ln -s ~/.config/keyd/default.conf /etc/keyd/default.conf

# TIP: Use `keyd monitor` to debug any issues

[ids]
*

[global]
chord_timeout = 50
layer_indicator = 0

[main]
# ğŸƒ Quick ESCAPE
f+j = esc

# ğŸ§¢ Ultimate Capslock
# overload(hold, click) | timeout(before, timeout, after)
# <300ms -> esc, <300ms+key -> control, >300ms -> capslock
capslock = timeout(overload(control, esc), 300, capslock)

# â–ˆâ–‘â–ˆ â–ˆâ–€â–ˆ â–ˆâ–€â–„â–€â–ˆ â–ˆâ–€â–€ â–ˆâ–€â–ˆ â–ˆâ–€â–ˆ â–ˆâ–‘â–ˆâ–‘â–ˆ   â–ˆâ–€â–„â–€â–ˆ â–ˆâ–€â–ˆ â–ˆâ–€â–„ â–ˆâ–€
# â–ˆâ–€â–ˆ â–ˆâ–„â–ˆ â–ˆâ–‘â–€â–‘â–ˆ â–ˆâ–ˆâ–„ â–ˆâ–€â–„ â–ˆâ–„â–ˆ â–€â–„â–€â–„â–€   â–ˆâ–‘â–€â–‘â–ˆ â–ˆâ–„â–ˆ â–ˆâ–„â–€ â–„â–ˆ
# @=================================================
# key = overloadt(overload_key, key, 300)
# Problem: J and K Scroll overloading won't be possible like this :(
# Solution: Timeout after overloading

# key = timeout(overloadt2(overload_key, key, 200), 300, key)
# Solved: Now it overloads like normal keys after certain timeout :D
# - Taps like normal keys within 200ms
# - Overloads into modifiers between 200ms and 300ms
# - Overloads like normal keys after 300ms
# Problem1: JK Overloading Navigation takes 300ms to activate
# Problem2: Modifiers unabailable before 200ms
# Solution1: QMK like doubletap overloading for JK navigation
# Solution2: Scroll & Navigation layer

# overload(<long_press>, <one_press>) # one_press if long_press not pressed
# overloadt2(<long_press>, <one_press>, <timeout>) # exits after timeout

# NOTE: Need overloadt2 for typing quick chords like "family" without
# accidentally triggering shift+a (fa), meta+m (am) etc. and alt+o (do)
# because of typing speed before 300ms. a lower bound like 200 fixes this

a = overloadt2(meta, a, 200)
s = overloadt2(control, s, 200)
d = timeout(overloadt2(alt, d, 200), 300, d)  # Less used in dangerous pos
f = overloadt2(shift, f, 200)

# timeout( overload(<long_press>, <one_press>), <timeout>, <repeat_after> )
j = timeout(overloadt2(shift, j, 200), 300, j)
k = timeout(overloadt2(alt, k, 200), 300, k)
l = timeout(overloadt2(control, l, 200), 300, l)
; = overloadt2(meta, ;, 200)


# â–ˆâ–„â–„ â–ˆâ–€â–ˆ â–€â–ˆâ–€ â–€â–ˆâ–€ â–ˆâ–€â–ˆ â–ˆâ–€â–„â–€â–ˆ â–ˆâ–€â–ˆ â–ˆâ–€â–ˆ â–ˆâ–‘â–ˆâ–‘â–ˆ   â–ˆâ–€â–„â–€â–ˆ â–ˆâ–€â–ˆ â–ˆâ–€â–„ â–ˆâ–€
# â–ˆâ–„â–ˆ â–ˆâ–„â–ˆ â–‘â–ˆâ–‘ â–‘â–ˆâ–‘ â–ˆâ–„â–ˆ â–ˆâ–‘â–€â–‘â–ˆ â–ˆâ–€â–„ â–ˆâ–„â–ˆ â–€â–„â–€â–„â–€   â–ˆâ–‘â–€â–‘â–ˆ â–ˆâ–„â–ˆ â–ˆâ–„â–€ â–„â–ˆ
# @=========================================================

# Inconvinient on a staggered keyboard but, this offers the best
# non-conflicting workflow

# z = overloadt2(meta, z, 300)
# x = overloadt2(control, x, 300)
# c = overloadt2(alt, c, 300)
# v = overloadt2(shift, v, 300)

# m = overloadt2(shift, m, 300)
# , = overloadt2(alt, ,, 300)
# . = overloadt2(control, ., 300)
# / = overloadt2(meta, /, 300)


# â–ˆâ–€ â–ˆâ–€â–ˆ â–„â–€â–ˆ â–ˆâ–€â–€ â–ˆâ–€â–€   â–ˆâ–‘â–‘ â–„â–€â–ˆ â–ˆâ–„â–ˆ â–ˆâ–€â–€ â–ˆâ–€â–ˆ
# â–„â–ˆ â–ˆâ–€â–€ â–ˆâ–€â–ˆ â–ˆâ–„â–„ â–ˆâ–ˆâ–„   â–ˆâ–„â–„ â–ˆâ–€â–ˆ â–‘â–ˆâ–‘ â–ˆâ–ˆâ–„ â–ˆâ–€â–„
# @=======================================
# Fixes timeout layer change :D but <leader>w problem comes up :(
# space = overload(parkour, space)
# Fixes <leader>w timeout wait :D but shifts to layer after timeout :(
space = overloadt(parkour, space, 200)

[parkour]
h = left
j = down
k = up
l = right
e = C-right
b = C-left
u = home
d = end
i = enter
; = backspace


# â–ˆâ–€â–„â–€â–ˆ â–ˆâ–€â–€ â–€â–ˆâ–€ â–„â–€â–ˆ   â–ˆâ–‘â–‘ â–„â–€â–ˆ â–ˆâ–„â–ˆ â–ˆâ–€â–€ â–ˆâ–€â–ˆ
# â–ˆâ–‘â–€â–‘â–ˆ â–ˆâ–ˆâ–„ â–‘â–ˆâ–‘ â–ˆâ–€â–ˆ   â–ˆâ–„â–„ â–ˆâ–€â–ˆ â–‘â–ˆâ–‘ â–ˆâ–ˆâ–„ â–ˆâ–€â–„
# @======================================
[meta]
# temporary numpad layer upon space in meta layer
space = overloadt(numpad, toggle(numpad), 200)
# space = toggle(numpad)

[control]
; = C-backspace

# ================================[ @NUMPAD ]================================ #

[numpad]
/ = .
n = 0
m = 1
, = 2
. = 3
j = 4
k = 5
l = 6
u = 7
i = 8
o = 9
1 = f1
2 = f2
3 = f3
4 = f4
5 = f5
6 = f6
7 = f7
8 = f8
9 = f9
[ = +
' = -
a = overloadt2(numpad_meta, a, 200)
; = overloadt2(numpad_meta, backspace, 200)
meta = layer(numpad_meta)

[numpad_meta:M]
space = toggle(dvorak)

# ================================[ @DVORAK ]================================ #

[dvorak]
' = -
, = w
- = [
. = v
/ = z
1 = 1
2 = 2
3 = 3
4 = 4
5 = 5
6 = 6
7 = 7
8 = 8
9 = 9
q = '
w = ,
e = .
r = p
t = y
y = f
u = g
i = c
o = r
p = l
a = overloadt2(dvorak_meta, a, 200)
s = overloadt2(control, o, 200)
d = overloadt2(alt, e, 200)
f = timeout(overloadt2(shift, u, 200), 300, u) # timeout for repeated C-u
g = i
h = d
j = overloadt2(shift, h, 200)
k = overloadt2(alt, t, 200)
l = timeout(overloadt2(control, n, 200), 300, n) # timeout for repeated C-n
; = overloadt2(dvorak_meta, s, 200)
z = ;
x = q
c = j
v = k
b = x
n = b
m = m
= = ]
[ = /
\ = \
] = =
shift = layer(dvorak_shift)
meta = layer(dvorak_meta)

[dvorak_meta:M]
space = clear()

[dvorak_shift:S]
' = _
, = W
- = {
. = V
/ = Z
1 = !
2 = @
3 = #
4 = $
5 = %
6 = ^
7 = &
8 = *
9 = (
; = S
= = }
[ = ?
\ = |
] = +
a = A
b = X
c = J
d = E
e = >
f = U
g = I
h = D
i = C
j = H
k = T
l = N
m = M
n = B
o = R
p = L
q = "
r = P
s = O
t = Y
u = G
v = K
w = <
x = Q
y = F
z = :
